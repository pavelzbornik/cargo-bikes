# Story 1.2: Custom Markdown Structural Linter

## Status

Draft

## Story

**As a** Developer,
**I want** a custom linter script that validates the structure of my Markdown notes,
**so that** I can ensure they are parseable before hydrating the database.

## Acceptance Criteria

1. A Python script (`scripts/linters/validate_structure.py`) is created.
2. The linter checks that every `.md` file in `vault/notes/` contains a valid YAML frontmatter block.
3. For bike notes (where `type: bike` is in the frontmatter), it verifies that a `<!-- BIKE_SPECS_TABLE_START -->` block exists in the body.
4. The script can be run from the command line and reports a list of invalid files with clear, actionable error messages.
5. If all files are valid, the script exits with a success code (0). If any file is invalid, it exits with an error code (non-zero).
6. Unit tests are created to validate both passing and failing file structures.

## Tasks / Subtasks

- ] Task 1: Create the new directory: `scripts/linters/`. (AC: 1)
- ] Task 2: Create the new script file: `scripts/linters/validate_structure.py`. (AC: 1)
- ] Task 3: Implement the main script logic to recursively scan all `.md` files within `vault/notes/`.
- ] Task 4: Implement YAML frontmatter validation logic. (AC: 2)
- [ It should check for the existence of the `---` separators.
- [ It should use the `PyYAML` library to try and parse the frontmatter.
- [ It should handle YAML parsing errors gracefully.
- ] Task 5: Implement the comment-fenced block validation logic. (AC: 3)
- [ First, parse the frontmatter to check if `type: bike`.
- [ If it is a bike note, scan the body of the file for the string `<!-- BIKE_SPECS_TABLE_START -->`.
- ] Task 6: Implement the CLI reporting and exit code logic. (AC: 4, 5)
- [ The script should collect all file paths that fail validation.
- [ If the list of failed files is not empty, print each path and the reason for failure to the console.
- [ The script should `sys.exit(1)` if any validation fails, and `sys.exit(0)` if all pass.
- ] Task 7: Create a new test file `tests/test_linter.py`. (AC: 6)
- [ Write unit tests for valid files (bike and non-bike notes).
- [ Write a unit test for a file with no frontmatter.
- [ Write a unit test for a file with invalid/malformed YAML frontmatter.
- [ Write a unit test for a bike note that is missing the `<!-- BIKE_SPECS_TABLE_START -->` block.

## Dev Notes

- Tech Stack\*\*: Use standard Python (~3.10) and the `PyYAML` library for parsing YAML. [Source: docs/architecture.md#Tech Stack Alignment]
- File Locations\*\*: The new script must be located at `scripts/linters/validate_structure.py`. The corresponding test file must be at `tests/test_linter.py`. [Source: docs/architecture.md#Source Tree Integration]
- Error Handling\*\*: The script must be robust. It should not crash on an invalid file but rather report it and continue checking other files. The final exit code should reflect the overall success or failure. [Source: Story 1.2 AC5]
- Testing\*\*: Use `pytest`. It's essential to test the failure cases to ensure the linter correctly identifies problems. You will need to create temporary mock `.md` files within your test functions to simulate different valid and invalid scenarios. [Source: docs/architecture.md#Testing Strategy]

## Change Log

| Date       | Version | Description         | Author |
| ---------- | ------- | ------------------- | ------ |
| 2024-05-22 | 1.0     | Initial story draft | Bob    |
