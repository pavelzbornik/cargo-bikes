# Story 1.1: Database Schema and Initialization

## Status

Draft

## Story

**As a** System Architect,
**I want** a SQLite database schema that perfectly mirrors the structures in `BIKE_SPECS_SCHEMA.md` and `MANUFACTURER_SCHEMA.md`,
**so that** we have a structured, queryable data store for all vault content.

## Acceptance Criteria

1. A Python script (`scripts/database/init_db.py`) is created that generates an empty SQLite database file (`vault.db`).
2. The script defines tables for `bikes`, `brands`, `components`, and `resellers` using a library like SQLAlchemy.
3. The table columns and relationships directly correspond to all fields defined in the `docs/schema/` markdown files.
4. The generated database file is added to `.gitignore` to prevent it from being committed to the repository.
5. Unit tests are created to verify that the schema is created correctly.

## Tasks / Subtasks

- [ ] Task 1: Create the new directory structure: `scripts/database/`.
- [ ] Task 2: In a new file `scripts/database/schema.py`, define the SQLAlchemy models for `bikes`, `brands`, `manufacturers`, `components`, and `resellers`. (AC: 2, 3)
  - [ ] Ensure all columns, types, and relationships map directly to the fields in `docs/schema/BIKE_SPECS_SCHEMA.md` and `docs/schema/MANUFACTURER_SCHEMA.md`.
- [ ] Task 3: In a new file `scripts/database/init_db.py`, create a function that uses the models from `schema.py` to generate the database file (`vault.db`) and create all tables. (AC: 1)
- [ ] Task 4: Add the line `vault.db` to the root `.gitignore` file. (AC: 4)
- [ ] Task 5: Create a new test file `tests/test_database_init.py`. (AC: 5)
  - [ ] Write a `pytest` unit test that calls the database initialization function using an in-memory SQLite database.
  - [ ] The test must verify that all expected tables (`bikes`, `brands`, etc.) are created successfully.
  - [ ] The test must inspect the created tables and verify that their columns match the expected fields from the schema documents.

## Dev Notes

- **Tech Stack**: Use Python (~3.10), SQLite for the database, and SQLAlchemy for the ORM and schema definition. [Source: docs/architecture.md#Tech Stack Alignment]
- **File Locations**: Create the new scripts in the `scripts/database/` directory as specified in the tasks. The new test file should be placed in `tests/`. [Source: docs/architecture.md#Source Tree Integration]
- **Schema Sources**: The database tables you define in `scripts/database/schema.py` must be a direct translation of the structures defined in `docs/schema/BIKE_SPECS_SCHEMA.md` and `docs/schema/MANUFACTURER_SCHEMA.md`. [Source: docs/architecture.md#Data Models and Schema Changes]
- **Testing**: Unit tests are mandatory for this story and must use `pytest`. The tests should validate the schema creation logic independently, for example by using an in-memory SQLite database. [Source: docs/architecture.md#Testing Strategy & Story 1.1 AC5]
- **Configuration**: Remember to add the database file `vault.db` to the `.gitignore` file to ensure it is not committed to the repository. [Source: Story 1.1 AC4]

## Change Log

| Date       | Version | Description         | Author |
| ---------- | ------- | ------------------- | ------ |
| 2024-05-22 | 1.0     | Initial story draft | Bob    |
